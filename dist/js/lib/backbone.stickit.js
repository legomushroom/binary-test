define("backbone.stickit",["backbone","jquery"],function(e,t){e.Stickit={_handlers:[],addHandler:function(e){e=_.map(_.flatten([e]),function(e){return _.extend({updateModel:!0,updateView:!0,updateMethod:"text"},e)}),this._handlers=this._handlers.concat(e)}},_.extend(e.View.prototype,{_modelBindings:null,unstickit:function(e){var t=[],n=this;_.each(this._modelBindings,function(r,i){if(e&&r.model!==e)return!1;r.model.off(r.event,r.fn),t.push(r.model),delete n._modelBindings[i]}),_.each(_.uniq(t),function(e){e.trigger("stickit:unstuck",n.cid)}),this._modelBindings=_.compact(this._modelBindings),this.$el.off(".stickit"+(e?"."+e.cid:""))},stickit:function(e,t){var n=this,i=e||this.model,p=".stickit."+i.cid,d=t||this.bindings||{};this._modelBindings||(this._modelBindings=[]),this.unstickit(i),_.each(_.keys(d),function(e){var t,v,m,g,y=d[e]||{},b=_.uniqueId();e!=":el"?t=n.$(e):(t=n.$el,e="");if(!t.length)return;_.isString(y)&&(y={observe:y}),_.isFunction(y.observe)&&(y.observe=y.observe.call(n)),g=f(t,y),m=g.observe,g.bindId=b,g.view=n,v=_.extend({stickitChange:g},g.setOptions||{}),l(n,t,g,i,m),c(n,t,g,i,m),m&&(_.each(g.events||[],function(r){var o=r+p,a=function(e){var r=g.getVal.call(n,t,e,g,_.rest(arguments));s(n,g.updateModel,r,g)&&u(i,m,r,v,n,g)};e===""?n.$el.on(o,a):n.$el.on(o,e,a)}),_.each(_.flatten([m]),function(e){o(i,n,"change:"+e,function(e,r,i){var s=i&&i.stickitChange&&i.stickitChange.bindId||null;s!=b&&h(n,t,g,a(e,m,g,n),e)})}),h(n,t,g,a(i,m,g,n),i,!0)),i.on("stickit:unstuck",function(e){e==n.cid&&r(n,g.destroy,t,i,g)}),r(n,g.initialize,t,i,g)}),this.remove=_.wrap(this.remove,function(e){var t=n;return n.unstickit(),e&&(t=e.apply(n,_.rest(arguments))),t})}});var n=function(e,t){var n=(t||"").split("."),r=_.reduce(n,function(e,t){return e[t]},e);return r==null?e:r},r=function(e,t){if(t)return(_.isString(t)?e[t]:t).apply(e,_.toArray(arguments).slice(2))},i=function(e){return e.find("option").not(function(){return!this.selected})},s=function(e,t){return _.isBoolean(t)?t:_.isFunction(t)||_.isString(t)?r.apply(this,_.toArray(arguments)):!1},o=function(e,t,n,r){e.on(n,r,t),t._modelBindings.push({model:e,event:n,fn:r})},u=function(e,t,n,i,s,o){o.onSet&&(n=r(s,o.onSet,n,o)),e.set(t,n,i)},a=function(e,t,n,i){var s,o=function(t){var r=n.escape?e.escape(t):e.get(t);return _.isUndefined(r)||_.isNull(r)?"":r};return s=_.isArray(t)?_.map(t,o):o(t),n.onGet?r(i,n.onGet,s,n):s},f=e.Stickit.getConfiguration=function(t,n){var r=[{updateModel:!1,updateMethod:"text",update:function(e,t,n,r){e[r.updateMethod]&&e[r.updateMethod](t)},getVal:function(e,t,n){return e[n.updateMethod]()}}];_.each(e.Stickit._handlers,function(e){t.is(e.selector)&&r.push(e)}),r.push(n);var i=_.extend.apply(_,r);return i.visible&&!_.has(i,"updateView")?i.updateView=!1:_.has(i,"updateView")||(i.updateView=!0),delete i.selector,i},l=function(e,t,n,r,i){var s=["autofocus","autoplay","async","checked","controls","defer","disabled","hidden","loop","multiple","open","readonly","required","scoped","selected"];_.each(n.attributes||[],function(n){var u="",f,l;n=_.clone(n),f=n.observe||(n.observe=i),l=function(){var i=_.indexOf(s,n.name,!0)>-1?"prop":"attr",o=a(r,f,n,e);n.name=="class"?(t.removeClass(u).addClass(o),u=o):t[i](n.name,o)},_.each(_.flatten([f]),function(t){o(r,e,"change:"+t,l)}),l()})},c=function(e,t,n,i,s){if(n.visible==null)return;var u=function(){var o=n.visible,u=n.visibleFn,f=a(i,s,n,e),l=!!f;if(_.isFunction(o)||_.isString(o))l=r(e,o,f,n);u?r(e,u,t,l,n):l?t.show():t.hide()};_.each(_.flatten([s]),function(t){o(i,e,"change:"+t,u)}),u()},h=function(e,t,n,i,o,u){if(!s(e,n.updateView,i,n))return;r(e,n.update,t,i,o,n),u||r(e,n.afterUpdate,t,i,n)};e.Stickit.addHandler([{selector:'[contenteditable="true"]',updateMethod:"html",events:["input","change"]},{selector:"input",events:["propertychange","input","change"],update:function(e,t){e.val(t)},getVal:function(e){return e.val()}},{selector:"textarea",events:["propertychange","input","change"],update:function(e,t){e.val(t)},getVal:function(e){return e.val()}},{selector:'input[type="radio"]',events:["change"],update:function(e,t){e.filter('[value="'+t+'"]').prop("checked",!0)},getVal:function(e){return e.filter(":checked").val()}},{selector:'input[type="checkbox"]',events:["change"],update:function(e,n,r,i){e.length>1?(n||(n=[]),_.each(e,function(e){_.indexOf(n,t(e).val())>-1?t(e).prop("checked",!0):t(e).prop("checked",!1)})):_.isBoolean(n)?e.prop("checked",n):e.prop("checked",n==e.val())},getVal:function(e){var n;if(e.length>1)n=_.reduce(e,function(e,n){return t(n).prop("checked")&&e.push(t(n).val()),e},[]);else{n=e.prop("checked");var r=e.val();r!="on"&&r!=null&&(n?n=e.val():n=null)}return n}},{selector:"select",events:["change"],update:function(i,s,o,u){var a,f=u.selectOptions,l=f&&f.collection||undefined,c=i.prop("multiple");if(!f){f={};var h=function(e){return e.map(function(){return{value:this.value,label:this.text}}).get()};i.find("optgroup").length?(l={opt_labels:[]},i.find("> option").length&&(l.opt_labels.push(undefined),_.each(i.find("> option"),function(e){l[undefined]=h(t(e))})),_.each(i.find("optgroup"),function(e){var n=t(e).attr("label");l.opt_labels.push(n),l[n]=h(t(e).find("option"))})):l=h(i.find("option"))}f.valuePath=f.valuePath||"value",f.labelPath=f.labelPath||"label";var p=function(e,r,i){_.each(e,function(e){var s=t("<option/>"),o=e,u=function(e,t){s.text(e),o=t,s.data("stickit_bind_val",o),!_.isArray(o)&&!_.isObject(o)&&s.val(o)};e==="__default__"?u(f.defaultOption.label,f.defaultOption.value):u(n(e,f.labelPath),n(e,f.valuePath)),!c&&o!=null&&i!=null&&o==i||_.isObject(i)&&_.isEqual(o,i)?s.prop("selected",!0):c&&_.isArray(i)&&_.each(i,function(e){_.isObject(e)&&(e=n(e,f.valuePath)),(e==o||_.isObject(e)&&_.isEqual(o,e))&&s.prop("selected",!0)}),r.append(s)})};i.html("");var d=function(e,t){var r=window;return t.indexOf("this.")===0&&(r=e),t=t.replace(/^[a-z]*\.(.+)$/,"$1"),n(r,t)};_.isString(l)?a=d(this,l):_.isFunction(l)?a=r(this,l,i,u):a=l,a instanceof e.Collection&&(a=a.toJSON()),f.defaultOption&&p(["__default__"],i);if(_.isArray(a))p(a,i,s);else if(a.opt_labels)_.each(a.opt_labels,function(e){var n=t("<optgroup/>").attr("label",e);p(a[e],n,s),i.append(n)});else{var v=[],m;for(var g in a)m={},m[f.valuePath]=g,m[f.labelPath]=a[g],v.push(m);p(_.sortBy(v,f.comparator||f.labelPath),i,s)}},getVal:function(e){var n;return e.prop("multiple")?n=t(i(e).map(function(){return t(this).data("stickit_bind_val")})).get():n=i(e).data("stickit_bind_val"),n}}])});